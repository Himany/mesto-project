(()=>{"use strict";var e={d:(t,n)=>{for(var o in n)e.o(n,o)&&!e.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:n[o]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};e.d({},{b:()=>K,a:()=>I});var t=document.querySelectorAll(".popup"),n=document.querySelector(".popup_type_profile"),o=document.querySelector(".popup_type_add-mesto"),r=document.querySelector(".popup_type_mesto"),c=document.querySelector(".popup_type_delete-confirm"),a=document.querySelector(".popup_type_update-avatar"),u=document.querySelector(".popup__item_type_profile-name"),i=document.querySelector(".popup__item_type_profile-capture"),l=document.querySelector(".popup__item_type_addmesto-name"),s=document.querySelector(".popup__item_type_addmesto-link"),p=document.querySelector(".popup__item_type_update-avatar"),d=document.querySelector(".popup__form_type_profile"),_=document.querySelector(".popup__form_type_add-mesto"),m=document.querySelector(".popup__form_type_delete-confirm"),f=document.querySelector(".popup__form_type_update-avatar"),v=document.querySelector(".profile__edit-but"),y=document.querySelector(".profile__add"),S=document.querySelector(".profile__avatar-edit-button"),C=document.querySelector(".popup__img"),q=document.querySelector(".popup__capture"),h=document.querySelector(".profile__avatar"),g=document.querySelector(".profile__title"),L=document.querySelector(".profile__subtitle"),E=document.querySelector("#element").content.querySelector(".element"),k=document.querySelector(".popup__save_type_profile"),b=document.querySelector(".popup__save_type_add-mesto"),x=document.querySelector(".popup__save_type_delete-confirm"),A=document.querySelector(".popup__save_type_update-avatar"),U=document.querySelectorAll(".popup__close"),P=document.querySelector(".elements"),T={formSelector:".popup__form",inputSelector:".popup__item",submitButtonSelector:".popup__save",inactiveButtonClass:"popup__save_disabled",inputContainer:".popup__item-container",inputErrorClass:"popup__item_error",errorClass:".popup__item-error",errorClassActive:"popup__item-error_active"};function B(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?function(e,t){e.classList.remove(t.inactiveButtonClass),e.disabled=!1}(t,n):w(t,n)}function w(e,t){e.classList.add(t.inactiveButtonClass),e.disabled=!0}var D,O={baseUrl:"https://nomoreparties.co/v1/plus-cohort-22",getCardsUrl:"/cards",getCardLikesUrl:"/cards/likes",getProfileUrl:"/users/me",getAvatarUrl:"/users/me/avatar",headers:{authorization:"9c3089de-d2f6-4f94-8f18-89f9e74580b3"},headersJson:{authorization:"9c3089de-d2f6-4f94-8f18-89f9e74580b3","Content-Type":"application/json"}};function j(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"GET",n=arguments.length>2?arguments[2]:void 0,o={method:t,headers:O.headers};return n&&(o={method:t,headers:O.headersJson,body:JSON.stringify(n)}),fetch(O.baseUrl+e,o).then((function(e){if(e.ok)return e.json();throw new Error(e.status)}))}function N(e,t,n,o,r,c){P.prepend(function(e,t,n,o,r,c){var a=E.cloneNode(!0),u=a.querySelector(".element__img"),i=a.querySelector(".element__trash"),l=a.querySelector(".element__title"),s=a.querySelector(".element__like"),p=a.querySelector(".element__like-count");return u.addEventListener("click",K),c?i.addEventListener("click",(function(){I(r)})):i.remove(),s.addEventListener("click",(function(e){!function(e,t,n){e.target.classList.contains("element__like_active")?function(e){return j(O.getCardLikesUrl+"/"+e,"DELETE")}(t).then((function(t){e.target.classList.remove("element__like_active"),n.textContent=t.likes.length})).catch((function(e){console.log(e)})):function(e){return j(O.getCardLikesUrl+"/"+e,"PUT")}(t).then((function(t){e.target.classList.add("element__like_active"),n.textContent=t.likes.length})).catch((function(e){console.log(e)}))}(e,r,p)})),a.dataset.id=r,u.src=t,u.alt=e,l.textContent=e,p.textContent=o,n&&s.classList.add("element__like_active"),a}(e,t,n,o,r,c))}function J(e){h.src=e}function M(e){g.textContent=e}function z(e){L.textContent=e}function H(e){e.classList.add("popup_opened"),document.addEventListener("keydown",V)}function G(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",V)}function V(e){"Escape"===e.key&&G(document.querySelector(".popup_opened"))}function F(e){e.target.classList.contains("popup")&&G(e.target)}function I(e){m.dataset.id=e,x.textContent="Да",H(c)}function K(e){C.src=e.target.src,C.alt=e.target.alt,q.textContent=e.target.alt,H(r)}Promise.all([j(O.getProfileUrl),j(O.getCardsUrl)]).then((function(e){J(e[0].avatar),M(e[0].name),z(e[0].about),e[1].reverse().forEach((function(t){var n=t.likes.some((function(t){return t._id===e[0]._id})),o=t.owner._id===e[0]._id;N(t.name,t.link,n,t.likes.length,t._id,o)}))})).catch((function(e){console.log("Ошибка: "+e)})),v.addEventListener("click",(function(){u.value=g.textContent,i.value=L.textContent,B(Array.from(n.querySelectorAll(T.inputSelector)),n.querySelector(T.submitButtonSelector),T),k.textContent="Сохранить",H(n)})),y.addEventListener("click",(function(){b.textContent="Сохранить",H(o)})),S.addEventListener("click",(function(){A.textContent="Сохранить",H(a)})),U.forEach((function(e){var t=e.closest(".popup");e.addEventListener("click",(function(){return G(t)}))})),d.addEventListener("submit",(function(e){var t;e.preventDefault(),k.textContent="Сохранение...",(t={name:u.value,about:i.value},j(O.getProfileUrl,"PATCH",t)).then((function(e){M(e.name),z(e.about),G(n)})).catch((function(e){k.textContent="Попробовать снова (".concat(e,")")}))})),_.addEventListener("submit",(function(e){var t;e.preventDefault(),b.textContent="Сохранение...",(t={name:l.value,link:s.value},j(O.getCardsUrl,"POST",t)).then((function(e){var t;N(e.name,e.link,!1,e.likes.length,e._id,!0),G(o),(t=_).reset(),w(t.querySelector(T.submitButtonSelector),T),b.textContent="Сохранить"})).catch((function(e){b.textContent="Попробовать снова (".concat(e,")")}))})),m.addEventListener("submit",(function(e){var t;e.preventDefault(),x.textContent="Удаление...",(t=e.target.dataset.id,j(O.getCardsUrl+"/"+t,"DELETE")).then((function(t){var n,o;n=e.target.dataset.id,(o=Array.from(document.querySelectorAll(".element")).find((function(e){return e.dataset.id===n})))&&o.closest(".element").remove(),G(c),x.textContent="Да"})).catch((function(e){b.textContent="Попробовать снова (".concat(e,")")}))})),f.addEventListener("submit",(function(e){e.preventDefault();var t={avatar:p.value};A.textContent="Сохранение...",function(e){return j(O.getAvatarUrl,"PATCH",e)}(t).then((function(e){J(e.avatar),G(a),A.textContent="Сохранить"})).catch((function(e){A.textContent="Попробовать снова (".concat(e,")")}))})),Array.from(t).forEach((function(e){e.addEventListener("click",F)})),D=T,Array.from(document.querySelectorAll(D.formSelector)).forEach((function(e){!function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);B(n,o,t),n.forEach((function(e){e.addEventListener("input",(function(){!function(e,t){e.setCustomValidity(e.validity.patternMismatch?e.dataset.errorMessage:""),e.validity.valid?function(e,t){var n=e.parentNode.querySelector(t.errorClass);e.classList.remove(t.inputErrorClass),n.classList.remove(t.errorClassActive),n.textContent=""}(e,t):function(e,t,n){var o=e.parentNode.querySelector(n.errorClass);e.classList.add(n.inputErrorClass),o.classList.add(n.errorClassActive),o.textContent=t}(e,e.validationMessage,t)}(e,t),B(n,o,t)}))}))}(e,D)}))})();